<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Client-Side Error</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: #fff;
        }

        #error-log {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #444;
        }

        #test-iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #444;
            border-radius: 8px;
        }

        .error-item {
            background: #3a1f1f;
            border: 1px solid #ff6b6b;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }

        .log-item {
            background: #1f3a1f;
            border: 1px solid #6bff6b;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }

        .info-item {
            background: #1f1f3a;
            border: 1px solid #6b6bff;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }

        button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #45a049;
        }

        .clear-btn {
            background: #f44336;
        }

        .clear-btn:hover {
            background: #da190b;
        }
    </style>
</head>

<body>
    <h1>üêõ Client-Side Error Debugger</h1>
    <p>This page helps debug client-side errors in the Tic-Tac-Toe application.</p>

    <div>
        <button onclick="loadSite()">üîÑ Reload Site</button>
        <button onclick="clearLog()" class="clear-btn">üóëÔ∏è Clear Log</button>
        <button onclick="checkConsole()">üìã Check Console</button>
        <button onclick="testAPI()">üîó Test API</button>
    </div>

    <div id="error-log">
        <div class="info-item">
            <strong>Debug Log Initialized</strong><br>
            Waiting for errors... Any JavaScript errors from the site will appear here.
        </div>
    </div>

    <iframe id="test-iframe" src="about:blank"></iframe>

    <script>
        const errorLog = document.getElementById('error-log');
        const iframe = document.getElementById('test-iframe');

        function addLogEntry(type, message, details = '') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = `${type}-item`;
            entry.innerHTML = `
                <strong>[${timestamp}] ${type.toUpperCase()}:</strong><br>
                ${message}
                ${details ? `<br><small>${details}</small>` : ''}
            `;
            errorLog.appendChild(entry);
            errorLog.scrollTop = errorLog.scrollHeight;
        }

        function clearLog() {
            errorLog.innerHTML = '<div class="info-item"><strong>Log Cleared</strong><br>Ready for new entries...</div>';
        }

        function loadSite() {
            addLogEntry('info', 'Loading production site...', 'https://tic-tac-toe-online-vercel.vercel.app/');
            iframe.src = 'https://tic-tac-toe-online-vercel.vercel.app/';
        }

        function checkConsole() {
            addLogEntry('info', 'Console check requested', 'Open browser DevTools > Console to see detailed errors');
        }

        async function testAPI() {
            addLogEntry('info', 'Testing API endpoints...');

            try {
                // Test health check
                const healthResponse = await fetch('https://tic-tac-toe-online-vercel.vercel.app/api/health-check');
                const healthData = await healthResponse.json();
                addLogEntry('log', 'Health Check API Response', `Status: ${healthResponse.status}, Data: ${JSON.stringify(healthData, null, 2)}`);

                // Test Pusher config
                const pusherResponse = await fetch('https://tic-tac-toe-online-vercel.vercel.app/api/pusher-config');
                const pusherData = await pusherResponse.json();
                addLogEntry('log', 'Pusher Config API Response', `Status: ${pusherResponse.status}, Data: ${JSON.stringify(pusherData, null, 2)}`);

            } catch (error) {
                addLogEntry('error', 'API Test Failed', error.toString());
            }
        }

        // Global error handler
        window.addEventListener('error', function (event) {
            addLogEntry('error', 'JavaScript Error Caught', `
                Message: ${event.message}<br>
                File: ${event.filename}<br>
                Line: ${event.lineno}<br>
                Column: ${event.colno}<br>
                Stack: ${event.error?.stack || 'No stack trace'}
            `);
        });

        // Promise rejection handler
        window.addEventListener('unhandledrejection', function (event) {
            addLogEntry('error', 'Unhandled Promise Rejection', `
                Reason: ${event.reason}<br>
                Promise: ${event.promise}
            `);
        });

        // Listen for iframe errors
        iframe.addEventListener('load', function () {
            addLogEntry('log', 'Site loaded successfully', 'No immediate loading errors detected');

            // Try to access iframe content (may be blocked by CORS)
            try {
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                addLogEntry('info', 'iframe accessible', 'Can inspect iframe content');

                // Check for any script errors in the iframe
                iframe.contentWindow.addEventListener('error', function (event) {
                    addLogEntry('error', 'iframe JavaScript Error', `
                        Message: ${event.message}<br>
                        Source: ${event.filename}<br>
                        Line: ${event.lineno}<br>
                        Column: ${event.colno}
                    `);
                });

            } catch (error) {
                addLogEntry('info', 'iframe CORS blocked', 'Cannot inspect iframe due to same-origin policy - this is normal');
            }
        });

        iframe.addEventListener('error', function () {
            addLogEntry('error', 'iframe failed to load', 'The site could not be loaded in the iframe');
        });

        // Load the site immediately
        addLogEntry('info', 'Debug page initialized', 'Ready to capture errors');
        loadSite();
    </script>
</body>

</html>